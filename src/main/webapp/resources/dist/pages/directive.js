define(["require","iScroll","hammer","angular","../common/js/baseUrl/baseUrl"],function(e){var t=e("iScroll"),n=e("hammer"),r=e("angular"),i=e("../common/js/baseUrl/baseUrl");return function(e){e.directive("tap",function(){return function(e,t,r,i){var s=new n(t[0]);s.on("tap",function(){e.$apply(r.tap),t.attr("href")&&t.attr("href")!="javascript:;"&&(location.href=r.href)})}}),e.directive("formValidated",function(){return{restrict:"A",require:"^?form",link:function(e,t,n,r){var i=t[0];t.on("submit",function(){var t=!1;for(var s=0;s<i.length;s++){var o=i[s].name;o&&r[o]&&r[o].$invalid&&(t=!0,r[o].$pristine=!1)}return t?e.$apply():e.$apply(n.formValidated),!1})}}}),e.directive("doValidate",function(){return{restrict:"A",require:"^?form",link:function(e,t,r,i){var s=new n(t[0]);s.on("tap",function(){var n=!1;e.isDisabled=!1;var s=r.doValidate;s&&i[s]&&(i[s].$invalid?(n=!0,i[s].$pristine=!1,t.attr("is-disabled","true")):t.attr("is-disabled","false"));if(n)return e.$apply(),!1})}}}),e.directive("bankCard",["validatePattern",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,n,r,i){i.$parsers.unshift(function(t){var r=n[0].selectionStart,s=t.split("");s.splice(r,0,"index");var o="",u=0;for(var a=0;a<s.length;a++)s[a]=="index"&&(r=o.length),/\d/.test(s[a])&&(o.length&&(o.length-u)%4==0&&(o+=" ",u++),o+=s[a]);n.val(o),n[0].setSelectionRange(r,r);var f=o.replace(/\s/g,"");return e.bankCard(f)?(i.$setValidity("bankCard",!0),f):(i.$setValidity("bankCard",!1),undefined)})}}}]),e.directive("idcard",["validatePattern",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,n,r,i){i.$parsers.unshift(function(t){var r=n[0].selectionStart,s=t.split(""),o=s[s.length-1];s.splice(r,0,"index");var u="",a=0;for(var f=0;f<s.length;f++){if(s[f]==="index"){r=u.length;continue}/\d/.test(s[f])&&(u.length>5&&(u.length+2-a)%4===0&&(u+=" ",a++),u+=s[f])}/x/i.test(o)&&(u+=o,r++),n.val(u),n[0].setSelectionRange(r,r);var l=u.replace(/\s/g,"");return e.idcard(l)?(i.$setValidity("idcard",!0),l):(i.$setValidity("idcard",!1),undefined)})}}}]),e.directive("phone",function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(e,t,n,r){r.$parsers.unshift(function(e){var n=t[0].selectionStart,i=e.split("");i.splice(n,0,"index");var s="",o=0;for(var u=0;u<i.length;u++)i[u]==="index"&&(n=s.length),/\d/.test(i[u])&&((s.length-o+1)%4==0&&(s+=" ",o++),s+=i[u]);t.val(s),t[0].setSelectionRange(n,n);var a=s.replace(/\D/g,"");return/^1[345678]\d{9}$/.test(a)?(r.$setValidity("phone",!0),a):(r.$setValidity("phone",!1),undefined)})}}}),e.directive("checkVerifyCode",["cache",function(e){var t=60;return e.set("timer",t),{restrict:"A",scope:!0,require:"^?form",link:function(r,i,s,o){function l(){i.html(a+"秒");var n=setInterval(function(){a--;if(a<0){a=t,e.set("timer",a),i.html(u),clearInterval(n),n=null;return}i.html(a+"秒"),e.set("timer",a)},1e3)}var u=i.html(),a=e.get("timer");a!==t&&l();var f=new n(i[0]);f.on("tap",function(){if(a!==t)return;var e=s.doValidate;e&&o[e]?o[e].$invalid||(r.$apply(s.checkVerifyCode),l()):(r.$apply(s.checkVerifyCode),l())})}}}]),e.directive("repeatKey",function(){return{require:"ngModel",link:function(e,t,n,r){var i=t.inheritedData("$formController")[n.repeatKey];r.$parsers.push(function(e){if(e===i.$viewValue)return r.$setValidity("repeatKey",!0),e;r.$setValidity("repeatKey",!1)}),i.$parsers.push(function(e){return r.$setValidity("repeatKey",e===r.$viewValue),e})}}}),e.directive("iscroll",["$parse",function(e){return{link:function(e,n,r){n[0].children[0].style.minHeight=n[0].offsetHeight+1+"px";var i=new t(n[0],{probeType:2,scrollbars:!0,fadeScrollbars:!0,shrinkScrollbars:"clip"})}}}]),e.directive("modal",function(){return{restrict:"A",link:function(e,t,n){var r=!1;t.on("webkitTransitionEnd transitionend",function(){!r&&t.css("display","none")}),e.$watch(n.modal,function(e){r=e,e?(t.css("display","block"),setTimeout(function(){t.addClass("modal-show")},0)):t.removeClass("modal-show")})}}}),e.directive("testCode",["$http","$state","$parse","baseUrl",function(e,t,r,i){var s=!0;return{restrict:"A",link:function(e,i,o){s=!0;var u=!1,a=new n(i[0]);a.on("tap",function(){var n=r(o.verifyCodeState)(e);if(n)t.go(o.targetPage,r(o.stateParams)(e));else{e.$apply(o.testCode);if(u)return;u=!0;var i=e.$watch(o.verifyCodeState,function(n){n&&s&&(i(),s=!1,t.go(o.targetPage,r(o.stateParams)(e)))})}return!1})}}}]),e.directive("cancelBubble",function(){return{restrict:"A",link:function(e,t,r){var i=new n(t[0]);i.on("tap",function(e){e.srcEvent.stopPropagation(),e.cancelBubble=!0})}}}),e.directive("backPage",["$state","$stateParams",function(e,t){return{restrict:"A",link:function(r,i,s){var o=new n(i[0]);o.on("tap",function(){history.length>1?history.back():e.go(s.backPage,t)})}}}])}});
